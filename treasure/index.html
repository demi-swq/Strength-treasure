<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯»å®å¤§å†’é™© - å…¨æ™¯åœ°å›¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* å…¨æ™¯åœ°å›¾å®¹å™¨ */
        .panorama-container {
            width: 100%;
            height: 100vh;
            position: relative;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><linearGradient id="sky" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:%23a8d8ff"/><stop offset="100%" style="stop-color:%23f0f8ff"/></linearGradient></defs><rect width="1200" height="800" fill="url(%23sky)"/><circle cx="1000" cy="150" r="80" fill="%23FFD700" opacity="0.8"/><path d="M0 600 Q300 500 600 550 T1200 600 L1200 800 L0 800 Z" fill="%2332CD32"/><path d="M100 650 Q150 600 200 650 T300 650 L300 800 L100 800 Z" fill="%23228B22"/><path d="M800 620 Q850 570 900 620 T1000 620 L1000 800 L800 800 Z" fill="%23228B22"/></svg>') no-repeat center/cover;
        }

        /* åœ°ç‚¹æ ‡è®° */
        .location {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .location:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .location.completed {
            background: #4CAF50 !important;
            animation: none;
        }

        .location.current {
            background: #FF9800 !important;
            animation: pulse 1s infinite;
        }

        /* å…·ä½“åœ°ç‚¹ä½ç½® */
        #library {
            background: #8B4513;
            top: 30%;
            left: 15%;
        }

        #jungle {
            background: #228B22;
            top: 40%;
            left: 25%;
        }

        #temple {
            background: #D2691E;
            top: 40%;
            left: 50%;
        }

        #chamber {
            background: #696969;
            top: 60%;
            left: 70%;
        }

        #treasury {
            background: #FFD700;
            top: 25%;
            left: 85%;
        }

        /* åœ°ç‚¹æ ‡ç­¾ */
        .location-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
        }

        /* æ ‡é¢˜ */
        .title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }

        .title h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        /* éŸ³ä¹æ§åˆ¶ */
        .music-control {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .music-control:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        /* è¿›åº¦æ¡ */
        .progress-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 600px;
        }

        .progress-bar {
            background: rgba(255,255,255,0.3);
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            background: #4CAF50;
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            color: white;
            text-align: center;
            margin-top: 5px;
            font-size: 14px;
        }

        /* åœ°ç‚¹é¡µé¢çš„è¿”å›æŒ‰é’® */
        .location-back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .location-back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        /* éŸ³ä¹æç¤º */
        .music-prompt {
            position: absolute;
            top: 80px;
            right: 20px;
            background: rgba(0,0,0,0.5);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            display: none;
        }

        /* çº¿ç´¢å’Œå¥–åŠ±æ ·å¼ */
        .clue {
            background: rgba(255, 255, 255, 0.15);
            border-left: 4px solid #FFD700;
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .reward {
            background: rgba(76, 175, 80, 0.2);
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 4px;
            color: #d4ffd4;
        }
    </style>
</head>
<body>
    <div class="panorama-container" id="panorama">
        <div class="title">
            <h1>å¯»å®å¤§å†’é™©</h1>
            <p>ç‚¹å‡»åœ°ç‚¹å¼€å§‹æ¢ç´¢</p>
        </div>

        <!-- åœ°ç‚¹æ ‡è®° -->
        <div class="location" id="library" data-location="library" data-name="å›¾ä¹¦é¦†">
            ğŸ“š
            <div class="location-label">å›¾ä¹¦é¦†</div>
        </div>

        <div class="location" id="jungle" data-location="jungle" data-name="ä¸›æ—">
            ğŸŒ´
            <div class="location-label">ä¸›æ—</div>
        </div>

        <div class="location" id="temple" data-location="temple" data-name="ç¥åº™">
            ğŸ›ï¸
            <div class="location-label">ç¥åº™</div>
        </div>

        <div class="location" id="chamber" data-location="chamber" data-name="éªŒè¯å®¤">
            ğŸ”
            <div class="location-label">éªŒè¯å®¤</div>
        </div>

        <div class="location" id="treasury" data-location="treasury" data-name="å®ç®±å®¤">
            ğŸ’
            <div class="location-label">å®ç®±å®¤</div>
        </div>

        <!-- éŸ³ä¹æ§åˆ¶ -->
        <button class="music-control" id="musicToggle">ğŸµ</button>
        <div class="music-prompt" id="musicPrompt">ç‚¹å‡»éŸ³ä¹å›¾æ ‡å¼€å¯èƒŒæ™¯éŸ³ä¹</div>

        <!-- è¿›åº¦æ¡ -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">æ¢ç´¢è¿›åº¦: 0/5</div>
        </div>

        <!-- èƒŒæ™¯éŸ³ä¹ -->
        <audio id="bgMusic" loop>
            <source src="audio/panorama.mp3" type="audio/mpeg">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
        </audio>
    </div>

    <!-- åœ°ç‚¹é¡µé¢å®¹å™¨ -->
    <div id="locationContainer" style="display: none; width: 100%; height: 100vh;"></div>

    <script>
        class TreasureGame {
            constructor() {
                // åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€ï¼Œç¡®ä¿ä»ç©ºæ•°ç»„å¼€å§‹
                this.gameState = this.loadGameState();
                this.currentLocation = null;
                this.bgMusic = document.getElementById('bgMusic');
                this.musicToggle = document.getElementById('musicToggle');
                this.musicPrompt = document.getElementById('musicPrompt');
                this.progressFill = document.getElementById('progressFill');
                this.progressText = document.getElementById('progressText');
                this.locationMusic = null; // å½“å‰åœ°ç‚¹çš„éŸ³ä¹å…ƒç´ 
                
                this.initEventListeners();
                this.updateUI();
                
                // å°è¯•æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼Œä½†ç”±äºæµè§ˆå™¨é™åˆ¶å¯èƒ½éœ€è¦ç”¨æˆ·äº¤äº’
                this.tryPlayBackgroundMusic();
            }

            initEventListeners() {
                // åœ°ç‚¹ç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('.location').forEach(location => {
                    location.addEventListener('click', (e) => {
                        const locationType = e.currentTarget.dataset.location;
                        this.enterLocation(locationType);
                    });
                });

                // éŸ³ä¹æ§åˆ¶
                this.musicToggle.addEventListener('click', () => {
                    this.toggleMusic();
                    this.musicPrompt.style.display = 'none';
                });

                // é¡µé¢ä»»æ„ä½ç½®ç‚¹å‡»æ—¶å°è¯•æ’­æ”¾éŸ³ä¹ï¼ˆè§£å†³è‡ªåŠ¨æ’­æ”¾é™åˆ¶ï¼‰
                document.addEventListener('click', () => {
                    if (this.gameState.musicEnabled && this.bgMusic.paused) {
                        this.playBackgroundMusic();
                        this.musicPrompt.style.display = 'none';
                    }
                }, { once: true });

                // é¡µé¢å¸è½½æ—¶ä¿å­˜çŠ¶æ€
                window.addEventListener('beforeunload', () => {
                    this.saveGameState();
                });
            }

            enterLocation(locationType) {
                // æ£€æŸ¥æ˜¯å¦æŒ‰é¡ºåºæ¢ç´¢ï¼ˆå›¾ä¹¦é¦† â†’ ä¸›æ— â†’ ç¥åº™ â†’ éªŒè¯å®¤ â†’ å®ç®±å®¤ï¼‰
                const locationOrder = ['library', 'jungle', 'temple', 'chamber', 'treasury'];
                const currentIndex = locationOrder.indexOf(locationType);
                
                // åªæœ‰å·²å®Œæˆå‰åºåœ°ç‚¹æˆ–å½“å‰æ˜¯ç¬¬ä¸€ä¸ªåœ°ç‚¹æ—¶æ‰èƒ½è¿›å…¥
                if (currentIndex === 0 || 
                    this.gameState.completedChallenges.includes(locationOrder[currentIndex - 1])) {
                    
                    this.currentLocation = locationType;
                    const locationNames = {
                        library: 'å›¾ä¹¦é¦†',
                        jungle: 'ä¸›æ—',
                        temple: 'ç¥åº™',
                        chamber: 'éªŒè¯å®¤',
                        treasury: 'å®ç®±å®¤'
                    };

                    // éšè—å…¨æ™¯å›¾ï¼Œæ˜¾ç¤ºåœ°ç‚¹é¡µé¢
                    document.getElementById('panorama').style.display = 'none';
                    document.getElementById('locationContainer').style.display = 'block';

                    // åŠ è½½åœ°ç‚¹é¡µé¢
                    this.loadLocationPage(locationType, locationNames[locationType]);
                    
                    // è®°å½•å·²è®¿é—®çš„åœ°ç‚¹
                    if (!this.gameState.visitedLocations.includes(locationType)) {
                        this.gameState.visitedLocations.push(locationType);
                        this.saveGameState();
                        this.updateUI();
                    }
                } else {
                    // æç¤ºç”¨æˆ·éœ€è¦æŒ‰é¡ºåºæ¢ç´¢
                    const prevLocationName = {
                        'jungle': 'å›¾ä¹¦é¦†',
                        'temple': 'ä¸›æ—',
                        'chamber': 'ç¥åº™',
                        'treasury': 'éªŒè¯å®¤'
                    }[locationType];
                    
                    alert(`è¯·å…ˆå®Œæˆ${prevLocationName}çš„æŒ‘æˆ˜ï¼Œæ‰èƒ½è¿›å…¥è¿™é‡Œï¼`);
                }
            }

            exitLocation() {
                // åœæ­¢å½“å‰åœ°ç‚¹éŸ³ä¹
                if (this.locationMusic) {
                    this.locationMusic.pause();
                    this.locationMusic = null;
                }
                
                this.currentLocation = null;
                document.getElementById('panorama').style.display = 'block';
                document.getElementById('locationContainer').style.display = 'none';
                
                // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
                this.playBackgroundMusic();
            }

            // è·å–åœ°ç‚¹å¯¹åº”çš„èƒŒæ™¯éŸ³ä¹URL
            getLocationMusicUrl(locationType) {
                const musicMap = {
                    library: 'audio/library.mp3',
                    jungle: 'audio/jungle.mp3',
                    temple: 'audio/temple.mp3',
                    chamber: 'audio/chamber.mp3',
                    treasury: 'audio/treasury.mp3'
                };
                return musicMap[locationType];
            }

            loadLocationPage(locationType, locationName) {
                const container = document.getElementById('locationContainer');
                const musicUrl = this.getLocationMusicUrl(locationType);
                
                // åŠ è½½åœ°ç‚¹é¡µé¢å†…å®¹ï¼ŒåŒ…å«ä¸“é—¨çš„è¿”å›æŒ‰é’®
                container.innerHTML = `
                    <div style="width: 100%; height: 100vh; background: linear-gradient(135deg, #1e3c72, #2a5298); 
                                display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; position: relative;">
                        <!-- åœ°ç‚¹é¡µé¢çš„è¿”å›æŒ‰é’® -->
                        <button class="location-back-btn" id="locationBackBtn">è¿”å›å…¨æ™¯åœ°å›¾</button>
                        
                        <h1>${locationName}</h1>
                        <p>æ¬¢è¿æ¥åˆ°${locationName}ï¼è¿™é‡Œéšè—ç€é‡è¦çš„çº¿ç´¢...</p>
                        
                        <!-- åœ°ç‚¹èƒŒæ™¯éŸ³ä¹ -->
                        <audio id="locationMusic" loop>
                            <source src="${musicUrl}" type="audio/mpeg">
                            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
                        </audio>
                         
                        <!-- åœ°ç‚¹éŸ³ä¹æ§åˆ¶ -->
                        <button class="music-control" id="locationMusicToggle" style="top: 20px; right: 20px;">
                            ${this.gameState.musicEnabled ? 'ğŸµ' : 'ğŸ”‡'}
                        </button>
                        
                        <!-- åœ°ç‚¹å†…å®¹åŒºåŸŸ -->
                        <div id="locationContent" style="margin-top: 20px; padding: 20px; 
                             background: rgba(255,255,255,0.1); border-radius: 10px; max-width: 600px;">
                            <p>åœ°ç‚¹å†…å®¹åŠ è½½ä¸­...</p>
                        </div>
                    </div>
                `;

                // è·å–åœ°ç‚¹éŸ³ä¹å…ƒç´ å¹¶è®¾ç½®äº‹ä»¶ç›‘å¬
                this.locationMusic = document.getElementById('locationMusic');
                document.getElementById('locationMusicToggle').addEventListener('click', () => {
                    this.toggleMusic();
                });

                // ä¸ºåœ°ç‚¹é¡µé¢çš„è¿”å›æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬
                document.getElementById('locationBackBtn').addEventListener('click', () => {
                    this.exitLocation();
                });

                // æ ¹æ®åœ°ç‚¹ç±»å‹åŠ è½½å…·ä½“å†…å®¹
                this.loadLocationContent(locationType);
                
                // æ’­æ”¾åœ°ç‚¹éŸ³ä¹ï¼ˆå¦‚æœéŸ³ä¹æ˜¯å¼€å¯çŠ¶æ€ï¼‰
                if (this.gameState.musicEnabled) {
                    this.locationMusic.play().catch(e => {
                        console.log('åœ°ç‚¹éŸ³ä¹æ’­æ”¾å¤±è´¥:', e);
                    });
                }
                
                // æš‚åœèƒŒæ™¯éŸ³ä¹
                this.bgMusic.pause();
            }

            loadLocationContent(locationType) {
                // æ¯ä¸ªåœ°ç‚¹çš„æŒ‘æˆ˜å’Œçº¿ç´¢å†…å®¹
                const contentMap = {
                    library: {
                        title: 'ğŸ“š å¤è€å›¾ä¹¦é¦†',
                        description: 'å°˜å°çš„å¤ç±ä¸­è—ç€ç¬¬ä¸€ä¸ªçº¿ç´¢...',
                        challenge: 'è§£å¼€å¤è€çš„è°œé¢˜ï¼š"ä»€ä¹ˆä¸œè¥¿æ—©æ™¨ç”¨å››æ¡è…¿èµ°è·¯ï¼Œä¸­åˆç”¨ä¸¤æ¡è…¿èµ°è·¯ï¼Œæ™šä¸Šç”¨ä¸‰æ¡è…¿èµ°è·¯ï¼Ÿ"',
                        clue: 'è¿™æ˜¯è‘—åçš„æ–¯èŠ¬å…‹æ–¯ä¹‹è°œï¼Œç­”æ¡ˆæ˜¯"äºº"',
                        reward: 'è·å¾—äº†é’é“œé’¥åŒ™å’Œä¸‹ä¸€ä¸ªåœ°ç‚¹çš„åœ°å›¾ç¢ç‰‡',
                        icon: 'ğŸ“œ'
                    },
                    jungle: {
                        title: 'ğŸŒ´ ç¥ç§˜ä¸›æ—',
                        description: 'èŒ‚å¯†çš„ä¸›æ—ä¸­éšè—ç€é€šå¾€ç¥åº™çš„é“è·¯...',
                        challenge: 'æ‰¾å‡ºä¸›æ—ä¸­ä¸ä¼—ä¸åŒçš„æ¤ç‰©ï¼šæœ‰å››ç‰‡å¶å­çš„ä¸‰å¶è‰ã€çº¢è‰²çš„è•¨ç±»è¿˜æ˜¯å‘å…‰çš„è˜‘è‡ï¼Ÿ',
                        clue: 'é€šå¸¸çš„ä¸‰å¶è‰åªæœ‰ä¸‰ç‰‡å¶å­ï¼Œå››ç‰‡å¶å­çš„å¾ˆç¨€æœ‰',
                        reward: 'è·å¾—äº†é“¶é’¥åŒ™å’Œç¥åº™çš„å¯†ç ',
                        icon: 'ğŸ—ºï¸'
                    },
                    temple: {
                        title: 'ğŸ›ï¸ å¤ä»£ç¥åº™',
                        description: 'åº„ä¸¥çš„ç¥åº™ä¸­è—ç€å®ˆæŠ¤è€…çš„ç§˜å¯†...',
                        challenge: 'ç¥åº™å¤§é—¨éœ€è¦å¯†ç æ‰èƒ½æ‰“å¼€ï¼Œå¯†ç æ˜¯"å¤§åœ°çš„æ•°å­—"ï¼ˆæç¤ºï¼šä¸åœ°çƒæœ‰å…³çš„é‡è¦æ•°å­—ï¼‰',
                        clue: 'åœ°çƒæœ‰ä¸ƒå¤§æ´²å››å¤§æ´‹ï¼Œå¯†ç æ˜¯74',
                        reward: 'è·å¾—äº†é‡‘é’¥åŒ™å’ŒéªŒè¯å®¤çš„é€šè¡Œè¯',
                        icon: 'ğŸ”‘'
                    },
                    chamber: {
                        title: 'ğŸ” éªŒè¯å®¤',
                        description: 'è¿™é‡Œå¯ä»¥éªŒè¯ä½ æ‰¾åˆ°çš„é’¥åŒ™æ˜¯å¦æ­£ç¡®...',
                        challenge: 'å°†è·å¾—çš„é’¥åŒ™æŒ‰æ­£ç¡®é¡ºåºæ”¾å…¥é”å­”ï¼šé’é“œé’¥åŒ™ã€é“¶é’¥åŒ™ã€é‡‘é’¥åŒ™',
                        clue: 'é¡ºåºæ˜¯ä»ä½åˆ°é«˜ï¼šé’é“œ â†’ é“¶ â†’ é‡‘',
                        reward: 'è·å¾—äº†å®ç®±çš„æœ€ç»ˆé’¥åŒ™',
                        icon: 'ğŸ”'
                    },
                    treasury: {
                        title: 'ğŸ’ å®ç®±å®¤',
                        description: 'ä¼ è¯´ä¸­çš„å®è—å°±åœ¨è¿™é‡Œ...',
                        challenge: 'ä½¿ç”¨æœ€ç»ˆé’¥åŒ™æ‰“å¼€å®ç®±ï¼Œè·å¾—ä¼ è¯´ä¸­çš„å®è—ï¼',
                        clue: 'å°†é’¥åŒ™æ’å…¥é”å­”å¹¶é¡ºæ—¶é’ˆæ—‹è½¬',
                        reward: 'æ­å–œä½ æ‰¾åˆ°ä¼ è¯´ä¸­çš„å®è—ï¼å®Œæˆäº†æ‰€æœ‰æŒ‘æˆ˜ï¼',
                        icon: 'ğŸ’°'
                    }
                };

                const content = contentMap[locationType];
                const container = document.getElementById('locationContent');
                
                // æ£€æŸ¥æŒ‘æˆ˜æ˜¯å¦å·²å®Œæˆ
                const isCompleted = this.gameState.completedChallenges.includes(locationType);
                
                // æ ¹æ®æ˜¯å¦å®ŒæˆæŒ‘æˆ˜æ˜¾ç¤ºä¸åŒå†…å®¹
                let challengeContent = '';
                if (isCompleted) {
                    challengeContent = `
                        <div class="clue">${content.clue}</div>
                        <div class="reward">${content.reward}</div>
                        <div style="color: #4CAF50; margin-top: 15px; font-size: 1.2rem;">âœ“ æŒ‘æˆ˜å·²å®Œæˆ</div>
                    `;
                } else {
                    // ä¸ºå›¾ä¹¦é¦†æ·»åŠ å…·ä½“æŒ‘æˆ˜è¾“å…¥
                    if (locationType === 'library') {
                        challengeContent = `
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 20px 0;">
                                <strong>æŒ‘æˆ˜:</strong> ${content.challenge}
                            </div>
                            <input type="text" id="libraryAnswer" placeholder="è¾“å…¥ç­”æ¡ˆ" 
                                   style="padding: 8px; margin: 10px 0; width: 100%; background: rgba(255,255,255,0.1); 
                                          border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 4px;">
                            <button onclick="game.checkAnswer('${locationType}', document.getElementById('libraryAnswer').value)" 
                                    style="background: #4CAF50; color: white; border: none; padding: 10px 20px; 
                                           border-radius: 5px; cursor: pointer; font-size: 16px;">
                                æäº¤ç­”æ¡ˆ
                            </button>
                        `;
                    } 
                    // ä¸›æ—æŒ‘æˆ˜
                    else if (locationType === 'jungle') {
                        challengeContent = `
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 20px 0;">
                                <strong>æŒ‘æˆ˜:</strong> ${content.challenge}
                            </div>
                            <div style="margin: 15px 0;">
                                <label style="display: block; margin: 8px 0;">
                                    <input type="radio" name="jungleAnswer" value="clover"> æœ‰å››ç‰‡å¶å­çš„ä¸‰å¶è‰
                                </label>
                                <label style="display: block; margin: 8px 0;">
                                    <input type="radio" name="jungleAnswer" value="fern"> çº¢è‰²çš„è•¨ç±»
                                </label>
                                <label style="display: block; margin: 8px 0;">
                                    <input type="radio" name="jungleAnswer" value="mushroom"> å‘å…‰çš„è˜‘è‡
                                </label>
                            </div>
                            <button onclick="game.checkJungleAnswer()" 
                                    style="background: #4CAF50; color: white; border: none; padding: 10px 20px; 
                                           border-radius: 5px; cursor: pointer; font-size: 16px;">
                                æäº¤ç­”æ¡ˆ
                            </button>
                        `;
                    }
                    // ç¥åº™æŒ‘æˆ˜
                    else if (locationType === 'temple') {
                        challengeContent = `
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 20px 0;">
                                <strong>æŒ‘æˆ˜:</strong> ${content.challenge}
                            </div>
                            <input type="text" id="templeAnswer" placeholder="è¾“å…¥å¯†ç æ•°å­—" 
                                   style="padding: 8px; margin: 10px 0; width: 100%; background: rgba(255,255,255,0.1); 
                                          border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 4px;">
                            <button onclick="game.checkAnswer('${locationType}', document.getElementById('templeAnswer').value)" 
                                    style="background: #4CAF50; color: white; border: none; padding: 10px 20px; 
                                           border-radius: 5px; cursor: pointer; font-size: 16px;">
                                æäº¤å¯†ç 
                            </button>
                        `;
                    }
                    // éªŒè¯å®¤æŒ‘æˆ˜
                    else if (locationType === 'chamber') {
                        challengeContent = `
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 20px 0;">
                                <strong>æŒ‘æˆ˜:</strong> ${content.challenge}
                            </div>
                            <div id="keyContainer" style="margin: 20px 0; display: flex; gap: 10px; justify-content: center;">
                                <div class="key" draggable="true" data-key="bronze" style="padding: 10px; background: #cd7f32; border-radius: 5px; cursor: move;">é’é“œé’¥åŒ™</div>
                                <div class="key" draggable="true" data-key="silver" style="padding: 10px; background: #c0c0c0; border-radius: 5px; cursor: move;">é“¶é’¥åŒ™</div>
                                <div class="key" draggable="true" data-key="gold" style="padding: 10px; background: #ffd700; border-radius: 5px; cursor: move; color: #333;">é‡‘é’¥åŒ™</div>
                            </div>
                            <div id="lockContainer" style="margin: 20px 0; display: flex; gap: 10px; justify-content: center;">
                                <div class="lock" data-position="1" style="width: 80px; height: 40px; border: 2px dashed white; border-radius: 5px; display: flex; align-items: center; justify-content: center;">ä½ç½®1</div>
                                <div class="lock" data-position="2" style="width: 80px; height: 40px; border: 2px dashed white; border-radius: 5px; display: flex; align-items: center; justify-content: center;">ä½ç½®2</div>
                                <div class="lock" data-position="3" style="width: 80px; height: 40px; border: 2px dashed white; border-radius: 5px; display: flex; align-items: center; justify-content: center;">ä½ç½®3</div>
                            </div>
                            <button onclick="game.checkChamberAnswer()" 
                                    style="background: #4CAF50; color: white; border: none; padding: 10px 20px; 
                                           border-radius: 5px; cursor: pointer; font-size: 16px;">
                                éªŒè¯é¡ºåº
                            </button>
                        `;
                        
                        // è®¾ç½®æ‹–æ‹½åŠŸèƒ½
                        setTimeout(() => {
                            this.setupKeyDragAndDrop();
                        }, 100);
                    }
                    // å®ç®±å®¤æŒ‘æˆ˜
                    else if (locationType === 'treasury') {
                        challengeContent = `
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 20px 0;">
                                <strong>æŒ‘æˆ˜:</strong> ${content.challenge}
                            </div>
                            <div style="text-align: center; margin: 30px 0;">
                                <div id="treasureBox" style="font-size: 8rem; cursor: pointer; transition: transform 0.5s ease;">ğŸ“¦</div>
                            </div>
                            <button onclick="game.openTreasureBox()" 
                                    style="background: #4CAF50; color: white; border: none; padding: 10px 20px; 
                                           border-radius: 5px; cursor: pointer; font-size: 16px;">
                                æ‰“å¼€å®ç®±
                            </button>
                        `;
                    }
                }
                
                container.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 4rem; margin-bottom: 20px;">${content.icon}</div>
                        <h2>${content.title}</h2>
                        <p style="margin: 15px 0; font-size: 1.1rem;">${content.description}</p>
                        ${challengeContent}
                    </div>
                `;
            }

            // è®¾ç½®é’¥åŒ™æ‹–æ‹½åŠŸèƒ½
            setupKeyDragAndDrop() {
                let draggedKey = null;
                
                // ä¸ºé’¥åŒ™æ·»åŠ æ‹–æ‹½äº‹ä»¶
                document.querySelectorAll('.key').forEach(key => {
                    key.addEventListener('dragstart', (e) => {
                        draggedKey = e.target;
                        setTimeout(() => {
                            e.target.style.opacity = '0.4';
                        }, 0);
                    });
                    
                    key.addEventListener('dragend', (e) => {
                        e.target.style.opacity = '1';
                        draggedKey = null;
                    });
                });
                
                // ä¸ºé”å­”æ·»åŠ æ‹–æ”¾äº‹ä»¶
                document.querySelectorAll('.lock').forEach(lock => {
                    lock.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        lock.style.borderColor = '#4CAF50';
                    });
                    
                    lock.addEventListener('dragleave', () => {
                        lock.style.borderColor = 'white';
                    });
                    
                    lock.addEventListener('drop', (e) => {
                        e.preventDefault();
                        lock.style.borderColor = 'white';
                        
                        // æ¸…ç©ºå½“å‰é”å­”å¹¶æ·»åŠ æ–°é’¥åŒ™
                        lock.innerHTML = '';
                        const keyCopy = draggedKey.cloneNode(true);
                        keyCopy.draggable = false;
                        keyCopy.style.margin = '0';
                        lock.appendChild(keyCopy);
                        lock.setAttribute('data-key', draggedKey.getAttribute('data-key'));
                    });
                });
            }

            // æ£€æŸ¥ä¸›æ—æŒ‘æˆ˜ç­”æ¡ˆ
            checkJungleAnswer() {
                const selectedOption = document.querySelector('input[name="jungleAnswer"]:checked');
                if (!selectedOption) {
                    alert('è¯·é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆ');
                    return;
                }
                
                if (selectedOption.value === 'clover') {
                    this.completeChallenge('jungle');
                } else {
                    alert('ç­”æ¡ˆä¸æ­£ç¡®ï¼Œè¯·å†è¯•ä¸€æ¬¡ï¼');
                }
            }

            // æ£€æŸ¥éªŒè¯å®¤æŒ‘æˆ˜ç­”æ¡ˆ
            checkChamberAnswer() {
                const lock1 = document.querySelector('.lock[data-position="1"]').getAttribute('data-key');
                const lock2 = document.querySelector('.lock[data-position="2"]').getAttribute('data-key');
                const lock3 = document.querySelector('.lock[data-position="3"]').getAttribute('data-key');
                
                // æ­£ç¡®é¡ºåºï¼šé’é“œ â†’ é“¶ â†’ é‡‘
                if (lock1 === 'bronze' && lock2 === 'silver' && lock3 === 'gold') {
                    this.completeChallenge('chamber');
                } else {
                    alert('é’¥åŒ™é¡ºåºä¸æ­£ç¡®ï¼Œè¯·æŒ‰ç…§é’é“œã€é“¶ã€é‡‘çš„é¡ºåºæ’åˆ—ï¼');
                }
            }

            // æ‰“å¼€å®ç®±
            openTreasureBox() {
                // æ·»åŠ å®ç®±æ‰“å¼€åŠ¨ç”»
                const treasureBox = document.getElementById('treasureBox');
                treasureBox.style.transform = 'rotateY(180deg)';
                
                setTimeout(() => {
                    treasureBox.textContent = 'ğŸ’';
                    this.completeChallenge('treasury');
                }, 500);
            }

            // æ£€æŸ¥ç­”æ¡ˆ
            checkAnswer(locationType, answer) {
                if (!answer) {
                    alert('è¯·è¾“å…¥ç­”æ¡ˆ');
                    return;
                }
                
                // éªŒè¯ç­”æ¡ˆï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
                const correctAnswers = {
                    library: ['äºº', 'äººç±»', 'person', 'human'],
                    temple: ['74', '7 4']
                };
                
                const isCorrect = correctAnswers[locationType].some(correct => 
                    answer.trim().toLowerCase() === correct.toLowerCase()
                );
                
                if (isCorrect) {
                    this.completeChallenge(locationType);
                } else {
                    alert('ç­”æ¡ˆä¸æ­£ç¡®ï¼Œè¯·å†è¯•ä¸€æ¬¡ï¼');
                }
            }

            // å®ŒæˆæŒ‘æˆ˜
            completeChallenge(locationType) {
                if (!this.gameState.completedChallenges.includes(locationType)) {
                    // æ·»åŠ åˆ°å·²å®ŒæˆæŒ‘æˆ˜åˆ—è¡¨
                    this.gameState.completedChallenges.push(locationType);
                    
                    // ç‰¹æ®Šå¤„ç†ï¼šå¦‚æœæ˜¯æœ€åä¸€ä¸ªæŒ‘æˆ˜ï¼Œæ˜¾ç¤ºé€šå…³ä¿¡æ¯
                    if (locationType === 'treasury') {
                        this.gameState.gameCompleted = true;
                    }
                    
                    this.saveGameState();
                    this.loadLocationContent(locationType); // åˆ·æ–°å†…å®¹æ˜¾ç¤ºå·²å®Œæˆ
                    this.updateUI(); // æ›´æ–°è¿›åº¦æ˜¾ç¤º
                    
                    // æ˜¾ç¤ºå®Œæˆæç¤º
                    setTimeout(() => {
                        const locationNames = {
                            library: 'å›¾ä¹¦é¦†',
                            jungle: 'ä¸›æ—',
                            temple: 'ç¥åº™',
                            chamber: 'éªŒè¯å®¤',
                            treasury: 'å®ç®±å®¤'
                        };
                        
                        let message = `æ­å–œï¼ä½ å®Œæˆäº†${locationNames[locationType]}çš„æŒ‘æˆ˜ï¼`;
                        
                        // å¦‚æœå®Œæˆäº†æ‰€æœ‰æŒ‘æˆ˜
                        if (this.gameState.completedChallenges.length === 5) {
                            message = `æ­å–œä½ å®Œæˆäº†æ‰€æœ‰æŒ‘æˆ˜ï¼Œæ‰¾åˆ°ä¼ è¯´ä¸­çš„å®è—ï¼`;
                        } else {
                            // æç¤ºä¸‹ä¸€ä¸ªåœ°ç‚¹
                            const nextLocations = {
                                library: 'ä¸›æ—',
                                jungle: 'ç¥åº™',
                                temple: 'éªŒè¯å®¤',
                                chamber: 'å®ç®±å®¤'
                            };
                            
                            if (nextLocations[locationType]) {
                                message += ` ç°åœ¨å¯ä»¥å‰å¾€${nextLocations[locationType]}ç»§ç»­æ¢é™©äº†ï¼`;
                            }
                        }
                        
                        alert(message);
                    }, 500);
                }
            }

            getLocationName(locationType) {
                const locationNames = {
                    library: 'å›¾ä¹¦é¦†',
                    jungle: 'ä¸›æ—',
                    temple: 'ç¥åº™',
                    chamber: 'éªŒè¯å®¤',
                    treasury: 'å®ç®±å®¤'
                };
                return locationNames[locationType] || locationType;
            }

            updateUI() {
                // æ›´æ–°åœ°ç‚¹çŠ¶æ€
                document.querySelectorAll('.location').forEach(location => {
                    const locationType = location.dataset.location;
                    location.classList.remove('completed', 'current');
                    
                    // åªæœ‰å®ŒæˆæŒ‘æˆ˜çš„åœ°ç‚¹æ‰æ ‡è®°ä¸ºå·²å®Œæˆ
                    if (this.gameState.completedChallenges.includes(locationType)) {
                        location.classList.add('completed');
                    }
                    
                    if (this.currentLocation === locationType) {
                        location.classList.add('current');
                    }
                });

                // æ›´æ–°è¿›åº¦æ¡ - åŸºäºå·²å®Œæˆçš„æŒ‘æˆ˜æ•°é‡
                const totalLocations = 5;
                const completedCount = this.gameState.completedChallenges.length;
                const progress = (completedCount / totalLocations) * 100;
                this.progressFill.style.width = `${progress}%`;
                this.progressText.textContent = `æ¢ç´¢è¿›åº¦: ${completedCount}/${totalLocations}`;

                // æ›´æ–°æ‰€æœ‰éŸ³ä¹æ§åˆ¶æŒ‰é’®çš„å›¾æ ‡
                const musicIcon = this.gameState.musicEnabled ? 'ğŸµ' : 'ğŸ”‡';
                this.musicToggle.textContent = musicIcon;
                
                const locationMusicToggle = document.getElementById('locationMusicToggle');
                if (locationMusicToggle) {
                    locationMusicToggle.textContent = musicIcon;
                }
            }

            // å°è¯•æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼Œå¤„ç†æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾é™åˆ¶
            tryPlayBackgroundMusic() {
                if (this.gameState.musicEnabled) {
                    this.bgMusic.play().catch(e => {
                        console.log('è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’:', e);
                        // æ˜¾ç¤ºæç¤ºï¼Œå‘Šè¯‰ç”¨æˆ·éœ€è¦ç‚¹å‡»æ‰èƒ½æ’­æ”¾éŸ³ä¹
                        this.musicPrompt.style.display = 'block';
                        
                        // 3ç§’åè‡ªåŠ¨éšè—æç¤º
                        setTimeout(() => {
                            this.musicPrompt.style.display = 'none';
                        }, 3000);
                    });
                }
            }

            playBackgroundMusic() {
                if (this.gameState.musicEnabled) {
                    this.bgMusic.play().catch(e => {
                        console.log('èƒŒæ™¯éŸ³ä¹æ’­æ”¾å¤±è´¥:', e);
                    });
                }
            }

            toggleMusic() {
                this.gameState.musicEnabled = !this.gameState.musicEnabled;
                
                // æ›´æ–°èƒŒæ™¯éŸ³ä¹çŠ¶æ€
                if (this.gameState.musicEnabled) {
                    this.bgMusic.play().catch(e => {
                        console.log('éŸ³ä¹æ’­æ”¾å¤±è´¥:', e);
                    });
                } else {
                    this.bgMusic.pause();
                }
                
                // æ›´æ–°åœ°ç‚¹éŸ³ä¹çŠ¶æ€
                if (this.locationMusic) {
                    if (this.gameState.musicEnabled) {
                        this.locationMusic.play().catch(e => {
                            console.log('åœ°ç‚¹éŸ³ä¹æ’­æ”¾å¤±è´¥:', e);
                        });
                    } else {
                        this.locationMusic.pause();
                    }
                }
                
                // æ›´æ–°UIå’Œä¿å­˜çŠ¶æ€
                this.updateUI();
                this.saveGameState();
            }

            loadGameState() {
                const defaultState = {
                    visitedLocations: [],     // å·²è®¿é—®çš„åœ°ç‚¹
                    completedChallenges: [],  // å·²å®Œæˆçš„æŒ‘æˆ˜ï¼ˆå†³å®šè¿›åº¦ï¼‰
                    gameCompleted: false,     // æ¸¸æˆæ˜¯å¦å®Œå…¨ç»“æŸ
                    musicEnabled: true,       // éŸ³ä¹æ˜¯å¦å¼€å¯
                    lastPlayed: Date.now()    // æœ€åæ¸¸æˆæ—¶é—´
                };

                try {
                    const saved = localStorage.getItem('treasureGameState');
                    // å¦‚æœæœ‰ä¿å­˜çš„çŠ¶æ€ï¼Œè¿”å›å®ƒï¼Œå¦åˆ™è¿”å›é»˜è®¤çŠ¶æ€
                    if (saved) {
                        const parsedState = JSON.parse(saved);
                        // ç¡®ä¿æ‰€æœ‰å¿…è¦çš„å±æ€§éƒ½å­˜åœ¨
                        return { ...defaultState, ...parsedState };
                    }
                    return defaultState;
                } catch (e) {
                    console.log('åŠ è½½æ¸¸æˆçŠ¶æ€å¤±è´¥:', e);
                    // æ¸…é™¤å¯èƒ½æŸåçš„å­˜å‚¨æ•°æ®
                    localStorage.removeItem('treasureGameState');
                    return defaultState;
                }
            }

            saveGameState() {
                try {
                    this.gameState.lastPlayed = Date.now();
                    localStorage.setItem('treasureGameState', JSON.stringify(this.gameState));
                } catch (e) {
                    console.log('ä¿å­˜æ¸¸æˆçŠ¶æ€å¤±è´¥:', e);
                }
            }
        }

        // å¯åŠ¨æ¸¸æˆ
        const game = new TreasureGame();
    </script>
</body>
</html>
